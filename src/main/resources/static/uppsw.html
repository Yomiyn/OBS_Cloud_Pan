<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <!-- 依 赖 样 式 -->
    <link rel="stylesheet" href="component/layui/css/layui.css" />
    <link rel="stylesheet" href="admin/css/pearTab.css" />
    <link rel="stylesheet" href="admin/css/pearTheme.css" />
    <link rel="stylesheet" href="admin/css/pearLoad.css" />
    <link rel="stylesheet" href="admin/css/pearFrame.css" />
    <link rel="stylesheet" href="admin/css/pearAdmin.css" />
    <link rel="stylesheet" href="admin/css/pearNotice.css" />
    <link rel="stylesheet" href="admin/css/pearSocial.css" />
    <link rel="stylesheet" href="admin/css/pearMenu.css" />
    <!-- 主 题 更 换 -->
    <style id="pearadmin-bg-color"></style>

    <script src="js/jQuery.js"></script>
    <SCRIPT src="js/common.js"></SCRIPT>
<body>
<!--修改密码-->
<div class="modify-pwd-layer aux-self" id="modifypwdlayer">
    <form class="layui-form layui-row changePwd">
        <div class="layui-col-xs12 layui-col-sm6 layui-col-md6">
            <div class="layui-form-item">
                <label class="layui-form-label">旧密码</label>
                <div class="layui-input-block">
                    <input type="password" id="oldPassword" value="" placeholder="请输入旧密码" lay-verify="required|oldPwd" class="layui-input pwd">
                </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">新密码</label>
                    <div class="layui-input-block">
                    <input type="password" id="newPassword" value="" placeholder="请输入新密码" lay-verify="required|newPwd" id="oldPwd" class="layui-input pwd">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">确认密码</label>
                <div class="layui-input-block">
                    <input type="password" id="newPassword1" value="" placeholder="请确认密码" lay-verify="required|confirmPwd" class="layui-input pwd">
                </div>
            </div>
            <div class="layui-form-item">
                <div class="layui-input-block">
                    <button class="layui-btn" lay-submit="" lay-filter="changePwd">立即修改</button>
                    <button type="reset" class="layui-btn layui-btn-primary">重置</button>
                </div>
            </div>
        </div>
    </form>
</div>
</body>
<script src="component/layui/layui.js"></script>
<script>
   layui.use(['pearHash','form'],function () {
       var form = layui.form, layer = layui.layer;
       $("body").on("click",".layui-btn",function(){
           if ($("#newPassword").val()!=$("#newPassword").val())
               layer.msg("两次密码不一致")
           else{
               password = pearHash.md5($("#oldPassword").val());
               if(password=sessionStorage.getItem("userId"))
                   layer.msg("原密码错误")
               else{
                   var user={}
                   sessionStorage.setItem('password',$("#newPassword").val())
                   user.userId=sessionStorage.getItem('userId')
                   user.password=sessionStorage.getItem('password')
                   $.ajax({
                       url: "127.0.0.1:8080"+ "/person/uppsw",
                       method: "post",
                       dataType: "json",
                       contentType: 'application/json;charset=utf-8',
                       data: JSON.stringify(user),
                       success: function (data) {
                           if (data.staus == true){
                               sessionStorage.setItem("userId",data.userId);//存储用户信息到session
                               sessionStorage.setItem("userName",data.userName);//存储用户信息到session
                               sessionStorage.setItem("email",data.email);//存储用户信息到session
                               sessionStorage.setItem("phoneNum",data.phoneNum);//存储用户信息到session
                               if(data.role==1)
                                   window.location.href="index.html";
                               else
                                   window.location.href = "com_index.html";
                           }else {
                               //弹出错误提示
                               var $ = layui.jquery, layer = layui.layer;
                               layer.msg('用户名或密码错误，请重新输入！', {time: 3000, icon:5});
                           }
                       },
                       error: function (XMLHttpRequest, textStatus, errorThrown) {
                           console.log("失败" + XMLHttpRequest.status + ":" + textStatus + ":" + errorThrown);
                       }
                   })
               }
           }
       });
   })
</script>

</html>